# 后端 Dockerfile
FROM node:18-alpine

WORKDIR /app

# 复制 package 文件
COPY package*.json ./

# 安装依赖（bcryptjs 是纯 JS 实现，不需要编译工具）
RUN npm ci --only=production

# 复制后端代码
COPY server/ ./server/

# 创建上传目录
RUN mkdir -p server/uploads/articles server/uploads/photos server/uploads/home server/uploads/photos/thumbnails

# 暴露端口
EXPOSE 3001

# 启动服务
CMD ["node", "server/index.js"]

